<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å¹¸è¿æŠ½æˆ¿å·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5;
            margin: 0;
            padding: 16px;
            box-sizing: border-box;
        }
        .container {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 380px;
        }
        .title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #07c160;
            margin-bottom: 1.5rem;
        }
        .draw-button {
            background-color: #07c160;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1.125rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-bottom: 1.5rem;
        }
        .draw-button:hover {
            background-color: #06ad56;
        }
        .draw-button:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
        }
        .result-area {
            margin-top: 1.5rem;
            font-size: 1.125rem;
            color: #374151;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 8px;
        }
        .result-text-main {
            font-weight: 600;
            font-size: 1.25rem;
            color: #1f2937;
        }
        .result-text-room {
            font-weight: 700;
            font-size: 1.875rem;
            color: #ef4444;
            margin-top: 0.5rem;
            animation: popIn 0.5s ease-out;
        }
        .info-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 1.5rem;
        }
        
        @keyframes popIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">å¹¸è¿æŠ½æˆ¿å·</h1>
        <button id="drawButton" class="draw-button">å¼€å§‹æŠ½å¥–</button>
        <div id="resultArea" class="result-area">
            <p id="resultMessage" class="result-text-main">ç‚¹å‡»æŒ‰é’®æŠ½å–æ‚¨çš„å¹¸è¿æˆ¿å·ï¼</p>
            <p id="drawnRoom" class="result-text-room"></p>
        </div>
        <p class="info-text">æ¯ä½ç”¨æˆ·ä»…é™æŠ½å–ä¸€æ¬¡ï¼Œç¥æ‚¨å¥½è¿ï¼</p>
    </div>

    <script>
        const ALL_ROOMS = ['101', '201', '202', '203', '301'];
        const DRAWN_ROOMS_KEY = 'lottery_drawnRoomsList';
        const USER_HAS_DRAWN_KEY = 'lottery_userHasDrawn';
        const USER_DRAWN_ROOM_KEY = 'lottery_userDrawnRoom';

        const drawButton = document.getElementById('drawButton');
        const resultMessage = document.getElementById('resultMessage');
        const drawnRoomDisplay = document.getElementById('drawnRoom');

        // è·å–å·²æŠ½å–çš„æˆ¿é—´
        function getDrawnRooms() {
            const storedRooms = localStorage.getItem(DRAWN_ROOMS_KEY);
            return storedRooms ? JSON.parse(storedRooms) : [];
        }

        // ä¿å­˜å·²æŠ½å–çš„æˆ¿é—´
        function saveDrawnRooms(rooms) {
            localStorage.setItem(DRAWN_ROOMS_KEY, JSON.stringify(rooms));
        }

        // åˆå§‹åŒ–é¡µé¢
        function initialize() {
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æŠ½å–
            if (localStorage.getItem(USER_HAS_DRAWN_KEY) === 'true') {
                disableButtonAndShowPreviousResult();
                return;
            }

            // è·å–å·²æŠ½å–çš„æˆ¿é—´
            const drawnRooms = getDrawnRooms();
            const availableRooms = ALL_ROOMS.filter(room => !drawnRooms.includes(room));

            // å¦‚æœæ‰€æœ‰æˆ¿å·éƒ½è¢«æŠ½å®Œ
            if (availableRooms.length === 0) {
                resultMessage.textContent = 'å¤ªé—æ†¾äº†ï¼Œæ‰€æœ‰æˆ¿å·å·²è¢«æŠ½å®Œï¼';
                drawnRoomDisplay.textContent = '';
                drawButton.disabled = true;
                drawButton.textContent = 'æˆ¿å·å·²æŠ½å®Œ';
                return;
            }

            // æ˜¾ç¤ºå‰©ä½™æˆ¿å·æ•°é‡
            resultMessage.textContent = `è¿˜æœ‰ ${availableRooms.length} ä¸ªå¹¸è¿æˆ¿å·ï¼Œå¿«æ¥æŠ½å§ï¼`;
        }

        // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºç»“æœ
        function disableButtonAndShowPreviousResult() {
            drawButton.disabled = true;
            drawButton.textContent = 'å·²å‚ä¸æŠ½å¥–';
            const previouslyDrawnRoom = localStorage.getItem(USER_DRAWN_ROOM_KEY);
            if (previouslyDrawnRoom) {
                resultMessage.textContent = 'æ‚¨å·²ç»æŠ½è¿‡å¥–å•¦ï¼æ‚¨çš„å¹¸è¿æˆ¿å·æ˜¯ï¼š';
                drawnRoomDisplay.textContent = `ğŸ‰ ${previouslyDrawnRoom} ğŸ‰`;
            } else {
                resultMessage.textContent = 'æ‚¨å·²å‚ä¸è¿‡æœ¬æ¬¡æŠ½å¥–æ´»åŠ¨ã€‚';
                drawnRoomDisplay.textContent = '';
            }
        }

        // å¤„ç†æŠ½å¥–
        function handleDraw() {
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æŠ½å–
            if (localStorage.getItem(USER_HAS_DRAWN_KEY) === 'true') {
                disableButtonAndShowPreviousResult();
                return;
            }

            // è·å–å·²æŠ½å–çš„æˆ¿é—´
            const drawnRooms = getDrawnRooms();
            const availableRooms = ALL_ROOMS.filter(room => !drawnRooms.includes(room));

            // å¦‚æœæ²¡æœ‰å¯ç”¨æˆ¿å·
            if (availableRooms.length === 0) {
                resultMessage.textContent = 'å¤ªé—æ†¾äº†ï¼Œæ‰€æœ‰æˆ¿å·å·²è¢«æŠ½å®Œï¼';
                drawnRoomDisplay.textContent = '';
                drawButton.disabled = true;
                drawButton.textContent = 'æˆ¿å·å·²æŠ½å®Œ';
                return;
            }

            // éšæœºé€‰æ‹©ä¸€ä¸ªæˆ¿å·
            const randomIndex = Math.floor(Math.random() * availableRooms.length);
            const selectedRoom = availableRooms[randomIndex];

            // æ›´æ–°æ˜¾ç¤º
            resultMessage.textContent = 'æ­å–œæ‚¨æŠ½ä¸­äº†ï¼š';
            drawnRoomDisplay.textContent = `ğŸ‰ ${selectedRoom} ğŸ‰`;
            drawnRoomDisplay.style.animation = 'none';
            requestAnimationFrame(() => {
                setTimeout(() => {
                    drawnRoomDisplay.style.animation = 'popIn 0.5s ease-out';
                }, 0);
            });

            // æ›´æ–°å·²æŠ½å–çš„æˆ¿é—´åˆ—è¡¨
            drawnRooms.push(selectedRoom);
            saveDrawnRooms(drawnRooms);

            // æ ‡è®°ç”¨æˆ·å·²æŠ½å–
            localStorage.setItem(USER_HAS_DRAWN_KEY, 'true');
            localStorage.setItem(USER_DRAWN_ROOM_KEY, selectedRoom);

            // ç¦ç”¨æŒ‰é’®
            drawButton.disabled = true;
            drawButton.textContent = 'å·²æŠ½å–å¹¸è¿æˆ¿å·';
        }

        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        drawButton.addEventListener('click', handleDraw);

        // åˆå§‹åŒ–é¡µé¢
        initialize();
    </script>
</body>
</html>
