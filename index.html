<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>幸运抽房号</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5;
            margin: 0;
            padding: 16px;
            box-sizing: border-box;
        }
        .container {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 380px;
        }
        .title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #07c160;
            margin-bottom: 1.5rem;
        }
        .draw-button {
            background-color: #07c160;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1.125rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-bottom: 1.5rem;
        }
        .draw-button:hover {
            background-color: #06ad56;
        }
        .draw-button:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
        }
        .result-area {
            margin-top: 1.5rem;
            font-size: 1.125rem;
            color: #374151;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 8px;
        }
        .result-text-main {
            font-weight: 600;
            font-size: 1.25rem;
            color: #1f2937;
        }
        .result-text-room {
            font-weight: 700;
            font-size: 1.875rem;
            color: #ef4444;
            margin-top: 0.5rem;
            animation: popIn 0.5s ease-out;
        }
        .info-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 1.5rem;
        }
        
        @keyframes popIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">幸运抽房号</h1>
        <button id="drawButton" class="draw-button">开始抽奖</button>
        <div id="resultArea" class="result-area">
            <p id="resultMessage" class="result-text-main">点击按钮抽取您的幸运房号！</p>
            <p id="drawnRoom" class="result-text-room"></p>
        </div>
        <p class="info-text">每位用户仅限抽取一次，祝您好运！</p>
    </div>

    <script>
        const ALL_ROOMS = ['101', '201', '202', '203', '301'];
        const DRAWN_ROOMS_KEY = 'lottery_drawnRoomsList';
        const USER_HAS_DRAWN_KEY = 'lottery_userHasDrawn';
        const USER_DRAWN_ROOM_KEY = 'lottery_userDrawnRoom';

        const drawButton = document.getElementById('drawButton');
        const resultMessage = document.getElementById('resultMessage');
        const drawnRoomDisplay = document.getElementById('drawnRoom');

        // 获取已抽取的房间
        function getDrawnRooms() {
            const storedRooms = localStorage.getItem(DRAWN_ROOMS_KEY);
            return storedRooms ? JSON.parse(storedRooms) : [];
        }

        // 保存已抽取的房间
        function saveDrawnRooms(rooms) {
            localStorage.setItem(DRAWN_ROOMS_KEY, JSON.stringify(rooms));
        }

        // 初始化页面
        function initialize() {
            // 检查用户是否已抽取
            if (localStorage.getItem(USER_HAS_DRAWN_KEY) === 'true') {
                disableButtonAndShowPreviousResult();
                return;
            }

            // 获取已抽取的房间
            const drawnRooms = getDrawnRooms();
            const availableRooms = ALL_ROOMS.filter(room => !drawnRooms.includes(room));

            // 如果所有房号都被抽完
            if (availableRooms.length === 0) {
                resultMessage.textContent = '太遗憾了，所有房号已被抽完！';
                drawnRoomDisplay.textContent = '';
                drawButton.disabled = true;
                drawButton.textContent = '房号已抽完';
                return;
            }

            // 显示剩余房号数量
            resultMessage.textContent = `还有 ${availableRooms.length} 个幸运房号，快来抽吧！`;
        }

        // 禁用按钮并显示结果
        function disableButtonAndShowPreviousResult() {
            drawButton.disabled = true;
            drawButton.textContent = '已参与抽奖';
            const previouslyDrawnRoom = localStorage.getItem(USER_DRAWN_ROOM_KEY);
            if (previouslyDrawnRoom) {
                resultMessage.textContent = '您已经抽过奖啦！您的幸运房号是：';
                drawnRoomDisplay.textContent = `🎉 ${previouslyDrawnRoom} 🎉`;
            } else {
                resultMessage.textContent = '您已参与过本次抽奖活动。';
                drawnRoomDisplay.textContent = '';
            }
        }

        // 处理抽奖
        function handleDraw() {
            // 检查用户是否已抽取
            if (localStorage.getItem(USER_HAS_DRAWN_KEY) === 'true') {
                disableButtonAndShowPreviousResult();
                return;
            }

            // 获取已抽取的房间
            const drawnRooms = getDrawnRooms();
            const availableRooms = ALL_ROOMS.filter(room => !drawnRooms.includes(room));

            // 如果没有可用房号
            if (availableRooms.length === 0) {
                resultMessage.textContent = '太遗憾了，所有房号已被抽完！';
                drawnRoomDisplay.textContent = '';
                drawButton.disabled = true;
                drawButton.textContent = '房号已抽完';
                return;
            }

            // 随机选择一个房号
            const randomIndex = Math.floor(Math.random() * availableRooms.length);
            const selectedRoom = availableRooms[randomIndex];

            // 更新显示
            resultMessage.textContent = '恭喜您抽中了：';
            drawnRoomDisplay.textContent = `🎉 ${selectedRoom} 🎉`;
            drawnRoomDisplay.style.animation = 'none';
            requestAnimationFrame(() => {
                setTimeout(() => {
                    drawnRoomDisplay.style.animation = 'popIn 0.5s ease-out';
                }, 0);
            });

            // 更新已抽取的房间列表
            drawnRooms.push(selectedRoom);
            saveDrawnRooms(drawnRooms);

            // 标记用户已抽取
            localStorage.setItem(USER_HAS_DRAWN_KEY, 'true');
            localStorage.setItem(USER_DRAWN_ROOM_KEY, selectedRoom);

            // 禁用按钮
            drawButton.disabled = true;
            drawButton.textContent = '已抽取幸运房号';
        }

        // 添加事件监听器
        drawButton.addEventListener('click', handleDraw);

        // 初始化页面
        initialize();
    </script>
</body>
</html>
