<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å¹¸è¿æŠ½æˆ¿å·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5; /* ç±»ä¼¼å¾®ä¿¡çš„èƒŒæ™¯è‰² */
            margin: 0;
            padding: 16px;
            box-sizing: border-box;
        }
        .container {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 380px;
        }
        .title {
            font-size: 1.75rem; /* 28px */
            font-weight: 700;
            color: #07c160; /* å¾®ä¿¡ä¸»ç»¿è‰² */
            margin-bottom: 1.5rem; /* 24px */
        }
        .draw-button {
            background-color: #07c160;
            color: white;
            padding: 0.75rem 1.5rem; /* 12px 24px */
            border: none;
            border-radius: 8px;
            font-size: 1.125rem; /* 18px */
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-bottom: 1.5rem; /* 24px */
        }
        .draw-button:hover {
            background-color: #06ad56;
        }
        .draw-button:disabled {
            background-color: #d1d5db; /* gray-300 */
            cursor: not-allowed;
        }
        .result-area {
            margin-top: 1.5rem; /* 24px */
            font-size: 1.125rem; /* 18px */
            color: #374151; /* gray-700 */
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background-color: #f9fafb; /* gray-50 */
            border-radius: 8px;
        }
        .result-text-main {
            font-weight: 600;
            font-size: 1.25rem; /* 20px */
            color: #1f2937; /* gray-800 */
        }
        .result-text-room {
            font-weight: 700;
            font-size: 1.875rem; /* 30px */
            color: #ef4444; /* red-500 */
            margin-top: 0.5rem; /* 8px */
            animation: popIn 0.5s ease-out;
        }
        .info-text {
            font-size: 0.875rem; /* 14px */
            color: #6b7280; /* gray-500 */
            margin-top: 1.5rem; /* 24px */
        }

        @keyframes popIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">å¹¸è¿æŠ½æˆ¿å·</h1>
        <button id="drawButton" class="draw-button">å¼€å§‹æŠ½å¥–</button>
        <div id="resultArea" class="result-area">
            <p id="resultMessage" class="result-text-main">ç‚¹å‡»æŒ‰é’®æŠ½å–æ‚¨çš„å¹¸è¿æˆ¿å·ï¼</p>
            <p id="drawnRoom" class="result-text-room"></p>
        </div>
        <p class="info-text">æ¯ä½ç”¨æˆ·ä»…é™æŠ½å–ä¸€æ¬¡ï¼Œç¥æ‚¨å¥½è¿ï¼</p>
    </div>

    <script>
        const ALL_ROOMS = ['101', '201', '202', '203', '301'];
        const DRAWN_ROOMS_KEY = 'lottery_drawnRoomsList_v1';
        const USER_HAS_DRAWN_KEY = 'lottery_userHasDrawn_v1';
        const USER_DRAWN_ROOM_VALUE_KEY = 'lottery_userDrawnRoomValue_v1';

        const drawButton = document.getElementById('drawButton');
        const resultMessage = document.getElementById('resultMessage');
        const drawnRoomDisplay = document.getElementById('drawnRoom');

        function getDrawnRooms() {
            const storedRooms = localStorage.getItem(DRAWN_ROOMS_KEY);
            return storedRooms ? JSON.parse(storedRooms) : [];
        }

        function saveDrawnRooms(rooms) {
            localStorage.setItem(DRAWN_ROOMS_KEY, JSON.stringify(rooms));
        }

        function disableButtonAndShowPreviousResult() {
            drawButton.disabled = true;
            drawButton.textContent = 'å·²å‚ä¸æŠ½å¥–';
            const previouslyDrawnRoom = localStorage.getItem(USER_DRAWN_ROOM_VALUE_KEY);
            if (previouslyDrawnRoom) {
                 resultMessage.textContent = 'æ‚¨å·²ç»æŠ½è¿‡å¥–å•¦ï¼æ‚¨çš„å¹¸è¿æˆ¿å·æ˜¯ï¼š';
                 drawnRoomDisplay.textContent = `ğŸ‰ ${previouslyDrawnRoom} ğŸ‰`;
            } else {
                resultMessage.textContent = 'æ‚¨å·²å‚ä¸è¿‡æœ¬æ¬¡æŠ½å¥–æ´»åŠ¨ã€‚';
                drawnRoomDisplay.textContent = '';
            }
        }

        function initializeLottery() {
            if (localStorage.getItem(USER_HAS_DRAWN_KEY) === 'true') {
                disableButtonAndShowPreviousResult();
                return;
            }

            const drawnRooms = getDrawnRooms();
            const availableRoomsCount = ALL_ROOMS.length - drawnRooms.length;
            if (availableRoomsCount <= 0) {
                resultMessage.textContent = 'å¤ªé—æ†¾äº†ï¼Œæ‰€æœ‰æˆ¿å·å·²è¢«æŠ½å®Œï¼';
                drawnRoomDisplay.textContent = '';
                drawButton.disabled = true;
                drawButton.textContent = 'æˆ¿å·å·²æŠ½å®Œ';
            } else {
                resultMessage.textContent = `è¿˜æœ‰ ${availableRoomsCount} ä¸ªå¹¸è¿æˆ¿å·ï¼Œå¿«æ¥æŠ½å§ï¼`;
            }
        }

        function handleDraw() {
            if (localStorage.getItem(USER_HAS_DRAWN_KEY) === 'true') {
                disableButtonAndShowPreviousResult();
                return;
            }

            const drawnRooms = getDrawnRooms();
            const availableRooms = ALL_ROOMS.filter(room => !drawnRooms.includes(room));

            if (availableRooms.length === 0) {
                resultMessage.textContent = 'å¤ªé—æ†¾äº†ï¼Œæ‰€æœ‰æˆ¿å·å·²è¢«æŠ½å®Œï¼';
                drawnRoomDisplay.textContent = '';
                drawButton.disabled = true;
                drawButton.textContent = 'æˆ¿å·å·²æŠ½å®Œ';
                localStorage.setItem(USER_HAS_DRAWN_KEY, 'true'); // æ ‡è®°ç”¨æˆ·å·²å°è¯•ï¼Œå³ä½¿æ²¡æŠ½åˆ°
                return;
            }

            const randomIndex = Math.floor(Math.random() * availableRooms.length);
            const selectedRoom = availableRooms[randomIndex];

            resultMessage.textContent = 'æ­å–œæ‚¨æŠ½ä¸­äº†ï¼š';
            drawnRoomDisplay.textContent = `ğŸ‰ ${selectedRoom} ğŸ‰`;
            drawnRoomDisplay.style.animation = 'none'; // Reset animation
            requestAnimationFrame(() => {
                setTimeout(() => {
                    drawnRoomDisplay.style.animation = 'popIn 0.5s ease-out';
                }, 0);
            });

            drawnRooms.push(selectedRoom);
            saveDrawnRooms(drawnRooms);
            localStorage.setItem(USER_HAS_DRAWN_KEY, 'true');
            localStorage.setItem(USER_DRAWN_ROOM_VALUE_KEY, selectedRoom);

            drawButton.disabled = true;
            drawButton.textContent = 'å·²æŠ½å–å¹¸è¿æˆ¿å·';
        }

        drawButton.addEventListener('click', handleDraw);

        initializeLottery();
    </script>
</body>
</html>